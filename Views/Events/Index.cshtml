@model CSS.ViewModels.EventListVM
@{
    ViewData["Title"] = "Events";
}

<link rel="stylesheet" href="~/css/events.css" />

<div class="container my-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Events</h2>

        <div class="d-flex gap-2">
            <select id="categoryFilter" class="form-select w-auto">
                <option value="">All</option>
                @foreach (var c in Model.Categories)
                {
                    <option value="@c" selected="@(c == Model.SelectedCategory)">@c</option>
                }
            </select>

            @if (User.IsInRole("Admin"))
            {
                <a asp-controller="Events" asp-action="Create" class="btn btn-danger">
                    + Add Event
                </a>
            }
        </div>
    </div>

    <!-- UPCOMING -->
    <h4 class="fw-bold mb-3">Upcoming Events</h4>
    <div class="row g-4">

        @foreach (var e in Model.Upcoming)
        {
            <div class="col-md-4">
                @await Html.PartialAsync("_EventCard", e)
            </div>
        }

    </div>

    <!-- PAST EVENTS -->
    <h4 class="fw-bold mt-5 mb-3">Past Events</h4>
    <div class="row g-4">

        @foreach (var p in Model.Past.Take(8))
        {
            <div class="col-md-4">

                @await Html.PartialAsync("_EventCard", p)

                

            </div>
        }

    </div>

</div>

@section Scripts {
    <script>
        document.getElementById('categoryFilter').addEventListener('change', function () {
            const url = new URL(window.location.href);
            if (this.value) url.searchParams.set('category', this.value);
            else url.searchParams.delete('category');
            window.location.href = url;
        });
    </script>
}
