@model List<CSS.Models.GalleryImage>
@{
    ViewData["Title"] = "Gallery";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<!-- SWEETALERT CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    .gallery-title {
        font-size: 38px;
        font-weight: 900;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 2px;
        background: linear-gradient(90deg,#ff7eb3,#ff758c,#ffce00);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 30px;
        text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    .category-select {
        border-radius: 40px;
        padding: 10px 20px;
        background: #ffffff;
        border: 2px solid #ddd;
        transition: 0.3s;
    }

        .category-select:hover {
            border-color: #ff758c;
        }

    .btn-filter {
        background: linear-gradient(45deg,#ff758c,#ff7eb3);
        border: none;
        padding: 10px 25px;
        font-weight: bold;
        border-radius: 40px;
        color: white;
    }

    .btn-upload {
        background: linear-gradient(45deg,#00c6ff,#0072ff);
        border: none;
        padding: 10px 25px;
        font-weight: bold;
        border-radius: 40px;
        color: white;
    }

    .gallery-card {
        border-radius: 18px;
        overflow: hidden;
        backdrop-filter: blur(10px);
        background: rgba(255,255,255,0.35);
        border: 1px solid rgba(255,255,255,0.2);
        transition: all .4s;
        cursor: pointer;
    }

        .gallery-card:hover {
            transform: translateY(-7px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }

    .gallery-img {
        height: 220px;
        width: 100%;
        object-fit: cover;
        transition: 0.4s;
    }

    .gallery-card:hover .gallery-img {
        transform: scale(1.05);
        filter: brightness(75%);
    }

    .category-badge {
        background: linear-gradient(45deg,#ffce00,#ffa100);
        color: #000;
        padding: 5px 12px;
        font-size: 12px;
        border-radius: 30px;
        font-weight: bold;
    }

    .lightbox {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.92);
        justify-content: center;
        align-items: center;
        z-index: 9999;
        animation: fadeIn .3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .lightbox img {
        max-width: 92%;
        max-height: 92%;
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(255,255,255,0.5);
        animation: zoomIn .4s ease;
    }

    @@keyframes zoomIn {
        from {
            transform: scale(0.6);
        }

        to {
            transform: scale(1);
        }
    }
</style>

<div class="container mt-4">

    <h2 class="gallery-title"><i class="fa-solid fa-images"></i> Gallery Showcase</h2>

    <!-- FILTER FORM -->
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label>Category</label>
            <select name="category" class="form-select category-select">
                <option value="">All</option>
                @if (ViewBag.Categories != null)
                {
                    foreach (var c in ViewBag.Categories)
                    {
                        <option value="@c" selected="@(ViewBag.SelectedCategory == c)">@c</option>
                    }
                }
            </select>
        </div>

        <div class="col-md-3">
            <label>From Date</label>
            <input type="date" name="startDate" value="@ViewBag.StartDate" class="form-control" />
        </div>

        <div class="col-md-3">
            <label>To Date</label>
            <input type="date" name="endDate" value="@ViewBag.EndDate" class="form-control" />
        </div>

        <div class="col-md-3">
            <button class="btn btn-filter w-100">
                <i class="fa-solid fa-filter"></i> Search
            </button>
        </div>

        @if (User.IsInRole("Admin"))
        {
            <div class="col-md-12 text-end">
                <a href="/Gallery/Upload" class="btn btn-upload">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Upload New
                </a>
            </div>
        }
    </form>

    <!-- IMAGE GRID -->
    <div class="row mt-4">
        @foreach (var img in Model)
        {
            var base64 = Convert.ToBase64String(img.ImageData);
            var imageSrc = $"data:{img.ContentType};base64,{base64}";

            <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                <div class="gallery-card" onclick="openLightbox('@imageSrc')">

                    <img src="@imageSrc" class="gallery-img" />

                    <div class="p-3 d-flex justify-content-between align-items-center">
                        <span class="category-badge">@img.Category</span>
                        <span class="text-muted small">@img.UploadDate.ToString("dd MMM yyyy")</span>

                        @if (User.IsInRole("Admin"))
                        {
                            <button class="btn btn-danger btn-sm px-2 py-1 rounded-circle delete-btn"
                                    data-id="@img.Id" onclick="event.stopPropagation();">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        }
                    </div>

                </div>
            </div>
        }
    </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
    <img id="lightbox-img" />
</div>

<script>
    function openLightbox(src) {
        document.getElementById("lightbox-img").src = src;
        document.getElementById("lightbox").style.display = "flex";
    }

    function closeLightbox() {
        document.getElementById("lightbox").style.display = "none";
    }

    // SWEETALERT DELETE CONFIRM
    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", function () {
            let id = this.getAttribute("data-id");

            Swal.fire({
                title: "Are you sure?",
                text: "Once deleted, you won't be able to recover this image!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `/Gallery/Delete/${id}`;
                }
            });
        });
    });
</script>
