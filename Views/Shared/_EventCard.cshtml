@model CSS.Models.Event

@{
    string imgSrc = (Model.BannerImage != null && Model.BannerImage.Length > 0)
        ? $"data:{(string.IsNullOrWhiteSpace(Model.BannerImageType) ? "image/jpeg" : Model.BannerImageType)};base64,{Convert.ToBase64String(Model.BannerImage)}"
        : Url.Content("~/images/default-event.jpg");

    bool isPast = Model.StartDateTime.HasValue && Model.StartDateTime.Value < DateTime.Now;
    bool isAdmin = User.IsInRole("Admin");
}

<div class="card shadow-sm border-0 rounded-3 h-100 d-flex flex-column">

    <img src="@imgSrc"
         class="card-img-top"
         style="height:180px;object-fit:cover;border-radius:12px 12px 0 0;" />

    <div class="card-body d-flex flex-column">

        <h5 class="fw-bold">@Model.Title</h5>

        <p class="text-muted small mb-1">
            <i class="fa-solid fa-location-dot me-1"></i> @Model.Venue <br />
            <i class="fa-solid fa-calendar-days me-1"></i>
            @(Model.StartDateTime?.ToLocalTime().ToString("dd MMM yyyy, hh:mm tt"))
        </p>

        <p class="fw-semibold mb-2">
            @if (Model.Price > 0)
            {
                <span class="badge bg-warning text-dark px-3 py-2">৳ @Model.Price</span>
            }
            else
            {
                <span class="badge bg-success px-3 py-2">Free</span>
            }
        </p>

        @{
            string desc = Model.ShortDescription ?? "";
            if (desc.Length > 110)
                desc = desc.Substring(0, 110) + "...";
        }
        

        @if (isPast && !isAdmin)
        {
            <button class="btn btn-secondary btn-sm w-100 mt-auto" disabled>
                This Event Has Been Closed
            </button>
        }
        else
        {
            <a asp-controller="Events" asp-action="Details" asp-route-id="@Model.Id"
               class="btn btn-primary btn-sm w-100 mt-auto">
                Details
            </a>
        }
    </div>

    @if (isAdmin)
    {
        <div class="d-flex gap-2 bg-light p-2 border-top">
            <a asp-controller="Events" asp-action="Edit" asp-route-id="@Model.Id"
               class="btn btn-warning btn-sm w-50">
                <i class="fa-solid fa-pen"></i> Edit
            </a>

            <form asp-controller="Events" asp-action="Delete" asp-route-id="@Model.Id"
                  method="post" class="w-50"
                  onsubmit="return confirm('Are you sure you want to delete this event?');">
                @Html.AntiForgeryToken()

                <button type="submit" class="btn btn-danger btn-sm w-100">
                    <i class="fa-solid fa-trash"></i> Delete
                </button>
            </form>
        </div>
    }

</div>
