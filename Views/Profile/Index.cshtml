@model CSS.Models.ApplicationUser
@{
    ViewData["Title"] = "My Profile";
}

<!-- Leaflet Map CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

<style>
    body {
        background: linear-gradient(to bottom right, #1b2a6b, #1b2a6b);
        font-family: 'Segoe UI', sans-serif;
    }

    .profile-container {
        max-width: 900px;
    }

    .profile-card {
        border-radius: 20px;
        background: white;
        padding: 30px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }

    .profile-header img {
        border: 6px solid #1b2a6b;
        transition: 0.3s;
    }

        .profile-header img:hover {
            transform: scale(1.05);
        }

    .section-card {
        border: 0;
        border-radius: 14px;
        margin-bottom: 28px;
        background: #fff;
        box-shadow: 0 6px 18px rgba(0,0,0,0.1);
        transition: 0.2s;
    }

        .section-card:hover {
            transform: translateY(-3px);
        }

    .section-header {
        background: linear-gradient(to right, #1b2a6b, #3949ab);
        padding: 12px 18px;
        font-weight: bold;
        color: white;
        border-radius: 14px 14px 0 0;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.1rem;
        letter-spacing: 0.3px;
    }

        .section-header i {
            background: white;
            color: #1b2a6b;
            padding: 6px;
            border-radius: 50%;
            font-size: 14px;
        }

    .info-label {
        font-weight: 600;
        color: #1b2a6b;
    }

    .profile-edit-btn {
        background: #1b2a6b;
        border: none;
        color: white;
        padding: 8px 25px;
        border-radius: 8px;
        transition: 0.2s;
    }

        .profile-edit-btn:hover {
            background: #0d1a4b;
            color: white;
        }
</style>

<div class="container my-4 profile-container">

    <div class="profile-card">

        <!-- PROFILE HEADER -->
        <div class="text-center mb-4 profile-header">

            @if (Model.ProfileImageData != null && Model.ProfileImageData.Length > 0)
            {
                <img src="data:image/png;base64,@Convert.ToBase64String(Model.ProfileImageData)"
                     class="rounded-circle shadow mb-3"
                     style="width:150px;height:150px;object-fit:cover;" />
            }
            else if (!string.IsNullOrEmpty(Model.ProfileImagePath))
            {
                <img src="@Model.ProfileImagePath"
                     class="rounded-circle shadow mb-3"
                     style="width:150px;height:150px;object-fit:cover;" />
            }
            else
            {
                <img src="/profiles/default.png"
                     class="rounded-circle shadow mb-3"
                     style="width:150px;height:150px;object-fit:cover;" />
            }

            <h3 class="fw-bold text-primary">@Model.FullName</h3>
            <p class="text-muted fs-6">@Model.MemberType</p>

        </div>


        <!-- BASIC INFORMATION -->
        <div class="card section-card">
            <div class="section-header">
                <i class="fa-solid fa-id-card"></i> Basic Information
            </div>

            <div class="card-body row">
                <div class="col-md-6"><span class="info-label">Full Name (Bangla):</span> @Model.FullNameBn</div>
                <div class="col-md-3 mt-2"><span class="info-label">Gender:</span> @Model.Gender</div>
                <div class="col-md-3 mt-2"><span class="info-label">Date of Birth:</span> @Model.DateOfBirth?.ToString("dd MMM yyyy")</div>
                <div class="col-md-6 mt-3"><span class="info-label">Member Type:</span> @Model.MemberType</div>
                <div class="col-md-6 mt-3"><span class="info-label">Committee Position:</span> @Model.CommitteePosition</div>
                <div class="col-md-6 mt-3"><span class="info-label">Member Since:</span> @Model.MemberSince?.ToString("dd MMM yyyy")</div>
            </div>
        </div>


        <!-- CONTACT INFORMATION -->
        <div class="card section-card">
            <div class="section-header">
                <i class="fa-solid fa-phone"></i> Contact Information
            </div>

            <div class="card-body row">
                <div class="col-md-6"><span class="info-label">Mobile:</span> @Model.PhoneNumber</div>
                <div class="col-md-6"><span class="info-label">Alternative Mobile:</span> @Model.AlternativeMobile</div>
                <div class="col-md-6 mt-2"><span class="info-label">Present Address:</span> @Model.PresentAddress</div>
                <div class="col-md-6 mt-2"><span class="info-label">Permanent Address:</span> @Model.PermanentAddress</div>
                <div class="col-md-6 mt-2"><span class="info-label">District:</span> @Model.District</div>
                <div class="col-md-6 mt-2"><span class="info-label">Upazila:</span> @Model.Upazila</div>
                <div class="col-md-12 mt-2"><span class="info-label">Facebook Link:</span> <a href="@Model.FacebookLink" target="_blank">@Model.FacebookLink</a></div>
                <div class="col-md-12 mt-2"><span class="info-label">WhatsApp:</span> @Model.WhatsAppNumber</div>
            </div>
        </div>


        <!-- BLOOD DONATION -->
        <div class="card section-card">
            <div class="section-header">
                <i class="fa-solid fa-droplet"></i> Blood Donation Info
            </div>

            <div class="card-body row">
                <div class="col-md-4"><span class="info-label">Blood Group:</span> @Model.BloodGroup</div>
                <div class="col-md-4"><span class="info-label">Last Donation:</span> @Model.LastDonationDate?.ToString("dd MMM yyyy")</div>
                <div class="col-md-4"><span class="info-label">Next Available:</span> @Model.NextAvailableDonationDate?.ToString("dd MMM yyyy")</div>

                <div class="col-md-6 mt-3"><span class="info-label">Donation Eligibility:</span> @Model.DonationEligibility</div>
                <div class="col-md-6 mt-3"><span class="info-label">Total Donations:</span> @Model.TotalDonationCount</div>

                <div class="col-md-12 mt-3"><span class="info-label">Preferred Location:</span> @Model.PreferredDonationLocation</div>
            </div>
        </div>


        <!-- EDUCATION -->
        <div class="card section-card">
            <div class="section-header">
                <i class="fa-solid fa-graduation-cap"></i> Educational Information
            </div>

            <div class="card-body row">
                <div class="col-md-12"><span class="info-label">School:</span> @Model.SchoolName (@Model.SchoolGroup)</div>
                <div class="col-md-12 mt-2"><span class="info-label">College:</span> @Model.CollegeName (@Model.CollegeGroup)</div>
                <div class="col-md-12 mt-2"><span class="info-label">University:</span> @Model.UniversityName</div>
                <div class="col-md-6 mt-2"><span class="info-label">Department:</span> @Model.Department</div>
                <div class="col-md-6 mt-2"><span class="info-label">Student ID:</span> @Model.StudentId</div>
            </div>
        </div>


        <!-- BIO -->
        <div class="card section-card">
            <div class="section-header">
                <i class="fa-solid fa-lightbulb"></i> Personal Bio
            </div>

            <div class="card-body">
                <p><span class="info-label">Short Bio:</span><br /> @Model.ShortBio</p>
                <p><span class="info-label">Why Joined CSS:</span><br /> @Model.WhyJoined</p>
                <p><span class="info-label">Future Goals:</span><br /> @Model.FutureGoals</p>
                <p><span class="info-label">Hobbies:</span><br /> @Model.Hobbies</p>
            </div>
        </div>


        <!-- MAP LOCATION SECTION -->
        <div class="card section-card">
            <div class="section-header">
                <i class="fa-solid fa-location-dot"></i> Location
            </div>

            <div class="card-body">
                <div id="profileMap" style="height: 300px;"></div>
                <p class="mt-2"><strong>DMS:</strong> @Model.LocationDms</p>
            </div>
        </div>


        <a href="/Profile/Edit" class="profile-edit-btn">
            <i class="fa-solid fa-pen me-1"></i> Edit Profile
        </a>

    </div>

</div>

<!-- MAP SCRIPT -->
<script>
    var lat = @Model.Latitude ?? 23.8103;
    var lng = @Model.Longitude ?? 90.4125;

    var map = L.map('profileMap').setView([lat, lng], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    L.marker([lat, lng]).addTo(map).bindPopup("@Model.LocationDms");
</script>